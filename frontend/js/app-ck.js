// var APIServer = 'http://localhost:7070';
var APIServer="http://dev.chat.io",DELAY=3e3,app=angular.module("app",["ngResource","angularFileUpload"]);app.controller("ChatController",["$scope","Contact","Message","$timeout","$upload",function(e,t,n,r,i){e.current={id:0};e.contacts=t.query(function(t){e.current=t[0]});e.name="";e.ip_address="";e.port="";e.messages=[];e.toggleSubmitButton=function(){var t=0;e.name.length>0&&(t+=1);e.ip_address.length>0&&(t+=1);e.port.length>0&&(t+=1);return t!==3};e.submit=function(){var n=new t({name:e.name,ipAddress:e.ip_address,port:e.port});n.$save(function(t){e.name="";e.ip_address="";e.port="";typeof t.name=="string"&&e.contacts.push(t)})};e.delete=function(t){var n=e.contacts.indexOf(t);t.$delete({id:t.id},function(){e.contacts.splice(n,1)})};e.loadChat=function(t){e.current=t;n.query({id:e.current.id},function(t){e.messages=t})};e.sendMessage=function(){var t=new n;t.ip=e.current.ipAddress||e.current.ip_address;t.port=e.current.port;t.message=e.newMessage;t.$save();e.newMessage=""};e.onFileSelect=function(t){e.progress=!0;for(var n=0;n<t.length;n++){var r=t[n];e.upload=i.upload({url:APIServer+"/api/v1/upload",method:"POST",file:r}).progress(function(e){console.log("percent: "+parseInt(100*e.loaded/e.total))}).success(function(e,t,n,r){console.log(e)}).then(function(){e.progress=!1})}};(function s(){n.query({id:e.current.id},function(t){e.messages=t;r(s,DELAY)})})()}]);app.factory("Contact",["$resource",function(e){return e(APIServer+"/api/v1/contacts/:id")}]);app.factory("Message",["$resource",function(e){return e(APIServer+"/api/v1/messages/:id")}]);